# 🎯 Настройка Faceit Analyser API

## 📋 Что добавлено

В бот интегрирован **Faceit Analyser API** для отображения диаграмм ELO в анкетах пользователей.

### ✨ Новые возможности:
- 🎨 **Красивые графические диаграммы** - профессиональные графики ELO как изображения
- 📊 **Текстовые диаграммы** - вертикальные диаграммы с эмодзи (fallback)
- 📈 **Детальная статистика Faceit** - K/D, HLTV рейтинг, количество матчей  
- 🏆 **Пиковое ELO** - максимальный достигнутый рейтинг
- 🎯 **Тренды и аналитика** - рост/падение, средние значения
- ⚡ **Умное кэширование** - оптимизированные запросы к API

## 🔑 Как получить API ключ

1. Перейдите на сайт: https://docs.faceitanalyser.com/
2. Заполните форму запроса API ключа: https://docs.google.com/forms/d/e/1FAIpQLSfs8CXK-F7RHgJuIbsCvP9XYKsd8AVEGGxVGe1TQzJ0p0II9g/viewform
3. Дождитесь получения ключа на email

## ⚙️ Настройка бота

### 1. Создайте файл `.env` в корне проекта:

```bash
# Telegram Bot настройки
BOT_TOKEN=ваш_токен_телеграм_бота

# Faceit Analyser API
FACEIT_ANALYSER_API_KEY=ваш_api_ключ_здесь
FACEIT_ANALYSER_BASE_URL=https://faceitanalyser.com/api/
FACEIT_ANALYSER_CACHE_TTL=3600

# Остальные настройки (опционально)
DATABASE_PATH=data/bot.db
LOG_LEVEL=INFO
LOG_FILE=logs/bot.log
MAX_SEARCH_RESULTS=20
```

### 2. Установите новые зависимости:

```bash
pip install aiohttp>=3.8.0 matplotlib>=3.5.0 numpy>=1.21.0
```

Или просто обновите все зависимости:

```bash
pip install -r requirements.txt
```

### 3. Перезапустите бота

## 🎮 Как это работает

1. **Пользователь указывает Faceit URL** при создании профиля
2. **Бот извлекает никнейм** из URL (например, из `https://faceit.com/ru/players/nickname`)
3. **Запрашивает данные** у Faceit Analyser API по никнейму
4. **Кэширует результат** на 1 час для оптимизации
5. **Отображает диаграмму ELO** в анкете пользователя

## 📊 Примеры отображения

### 🎨 Графическая диаграмма (приоритет):
- Отправляется как **красивое изображение** с профессиональным графиком
- Темная тема в стиле CS2
- Цветные точки: зеленые (рост), красные (падение), синяя (текущая)  
- Аннотации пика и текущего ELO
- Заливка под графиком и статистика

### 📊 Текстовая диаграмма (fallback):
```
👤 PlayerName
🎯 ELO Faceit: 🟡 2150 ELO (Level 6)  
🔗 Faceit: nickname

📊 График ELO (последние матчи):

🟩🟩🟦     
🟩🟩🟦     
⬜🟥🟦🟩    
⬜🟥🟦🟩    
⬜🟥🟦🟩🟩   
⬜🟥🟦🟩🟩⬜  
⬜🟥🟦🟩🟩⬜🟥 
⬜🟥🟦🟩🟩⬜🟥⬜

2050 2000 2150 2200 2250 2100 2080 2120
#1   #2   #3   #4   #5   #6   #7   #8

🎯 Текущий ELO: 2120
📈 Пик: 2250 | 📉 Минимум: 2000  
🚀 Тренд: +70 (Растет)
📊 Средний ELO: 2125

📊 Faceit Статистика:
🎮 Матчей: 156 | 🏆 Побед: 89
⚔️ K/D: 1.24 | ⭐ HLTV: 1.15
📈 Пик ELO: 2250
```

## 🚀 Технические детали

### Новые файлы:
- `bot/utils/faceit_analyzer.py` - модуль работы с API
- `FACEIT_ANALYSER_SETUP.md` - эта инструкция

### Изменения в существующих файлах:
- `bot/config.py` - добавлены настройки API
- `bot/handlers/search.py` - графические диаграммы в поиске тиммейтов  
- `bot/handlers/profile.py` - диаграммы в личных профилях
- `requirements.txt` - добавлены зависимости: aiohttp, matplotlib, numpy

## 🔄 Кэширование

- Данные кэшируются на **1 час** (настраивается в `FACEIT_ANALYSER_CACHE_TTL`)
- Кэш хранится в памяти приложения
- При перезапуске бота кэш очищается

## ❌ Обработка ошибок

Бот корректно обрабатывает все возможные ошибки:
- ❌ **API ключ не установлен** - профили работают без диаграмм
- ❌ **Игрок не найден** - показывается обычная анкета
- ❌ **Превышен лимит запросов** - данные не загружаются
- ❌ **Ошибка сети** - профиль отображается без API данных

## 💰 Стоимость

- **До 5000 запросов/месяц** - бесплатно
- **Свыше 5000 запросов** - €1 за каждые 1000 запросов

## 🆘 Troubleshooting

### Диаграммы не отображаются?
1. Проверьте правильность API ключа в `.env`
2. Убедитесь что у пользователей указан корректный Faceit URL
3. Проверьте логи бота на ошибки API

### Медленная работа?
1. Увеличьте время кэширования (`FACEIT_ANALYSER_CACHE_TTL`)
2. Проверьте стабильность интернет-соединения
3. Мониторьте лимиты API

---

🎉 **Готово!** Теперь ваш бот показывает крутые диаграммы ELO в анкетах игроков!
