# –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: CASCADE DELETE –ë–ê–ì

**–î–∞—Ç–∞:** 31.08.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî• –ö–†–ò–¢–ò–ß–ù–ê–Ø (–ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

## üéØ –ü–†–û–ë–õ–ï–ú–ê

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å—á–µ–∑–∞–ª–∏ –ø–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –Ω–∞–∂–∞—Ç–∏—è "–ù–∞–∑–∞–¥"

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è
- –ü—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –ø—Ä–æ—Ñ–∏–ª—è –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–ù–∞–∑–∞–¥" –ø—Ä–æ—Ñ–∏–ª—å –∏—Å—á–µ–∑–∞–ª –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `has_profile()` –≤–æ–∑–≤—Ä–∞—â–∞–ª `False` –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –≠—Ç–∞–ø—ã —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:
1. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `handle_media_selection`, `save_profile`, `view_full_profile`
2. **Fallback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:** –°–æ–∑–¥–∞–Ω—ã –¥–ª—è –º–µ–¥–∏–∞ –≤–Ω–µ ConversationHandler
3. **–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã:** –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —á—Ç–æ –ø—Ä–æ—Ñ–∏–ª—å –∏—Å—á–µ–∑–∞–µ—Ç –º–µ–∂–¥—É `view_full_profile` –∏ `profile_command`

### –ö–ª—é—á–µ–≤—ã–µ –ª–æ–≥–∏:
```
20:08:26 - view_full_profile: has_profile_before=True ‚úÖ
20:08:26 - get_profile: –ü—Ä–æ—Ñ–∏–ª—å –£–°–ü–ï–®–ù–û —Å–æ–∑–¥–∞–Ω ‚úÖ  
20:08:27 - Profile handler –ø–æ–ª—É—á–∏–ª callback: profile_menu
20:08:27 - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 966874670 —Å–æ–∑–¥–∞–Ω/–æ–±–Ω–æ–≤–ª–µ–Ω üö®
20:08:27 - has_profile: user_id=966874670, result=False ‚ùå
```

## üéØ –ö–û–†–ï–ù–¨ –ü–†–û–ë–õ–ï–ú–´

**–í `profile_command()` –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ù–∞–∑–∞–¥" –≤—ã–∑—ã–≤–∞–ª—Å—è:**
```python
await self.db.create_user(user_id, username, first_name)  # –°—Ç—Ä–æ–∫–∏ 33-37
```

**–í `create_user()` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –æ–ø–∞—Å–Ω—ã–π SQL:**
```sql
INSERT OR REPLACE INTO users (user_id, username, first_name, created_at, is_active)
VALUES (?, ?, ?, ?, 1)
```

**–í —Å—Ö–µ–º–µ —Ç–∞–±–ª–∏—Ü—ã `profiles` –±—ã–ª–∞ —Å–≤—è–∑—å:**
```sql
FOREIGN KEY (user_id) REFERENCES users (user_id) ON DELETE CASCADE  -- –°—Ç—Ä–æ–∫–∞ 313
```

### üî• –ß–¢–û –ü–†–û–ò–°–•–û–î–ò–õ–û:
1. `INSERT OR REPLACE` **–£–î–ê–õ–Ø–ï–¢** —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users`
2. `ON DELETE CASCADE` **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –£–î–ê–õ–Ø–ï–¢** –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `profiles` 
3. –ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –Ω–æ –ø—Ä–æ—Ñ–∏–ª—å —É–∂–µ **–ò–°–ß–ï–ó**!

## ‚úÖ –†–ï–®–ï–ù–ò–ï

**–ó–∞–º–µ–Ω–∏–ª –æ–ø–∞—Å–Ω—ã–π `INSERT OR REPLACE` –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π UPSERT:**

```sql
INSERT INTO users (user_id, username, first_name, created_at, is_active)
VALUES (?, ?, ?, ?, 1)
ON CONFLICT(user_id) DO UPDATE SET
    username = excluded.username,
    first_name = excluded.first_name,
    is_active = 1
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ UPSERT:
- ‚úÖ **–ù–ï –£–î–ê–õ–Ø–ï–¢** —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
- ‚úÖ **–û–ë–ù–û–í–õ–Ø–ï–¢** —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è
- ‚úÖ **–°–û–•–†–ê–ù–Ø–ï–¢** –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–æ—Ñ–∏–ª–∏, –ª–∞–π–∫–∏, –º–∞—Ç—á–∏)
- ‚úÖ **–ê–¢–û–ú–ê–†–ù–ê–Ø –û–ü–ï–†–ê–¶–ò–Ø** –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è

## üõ†Ô∏è –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π** - —É–±—Ä–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
2. **Fallback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏** - –¥–ª—è –º–µ–¥–∏–∞ –≤–Ω–µ ConversationHandler  
3. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON** - –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–æ—Ä—Ä—É–ø—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

**–¢–µ—Å—Ç-–∫–µ–π—Å:**
1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —Å —Ñ–æ—Ç–æ ‚úÖ
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ‚úÖ  
3. –ù–∞–∂–∞—Ç—å "–ù–∞–∑–∞–¥" ‚úÖ
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–æ—Ñ–∏–ª—å –ù–ï –∏—Å—á–µ–∑ ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** üéâ –ü–†–û–§–ò–õ–¨ –°–û–•–†–ê–ù–Ø–ï–¢–°–Ø –ù–ê–í–°–ï–ì–î–ê!

## üìö –£–†–û–ö–ò

1. **`INSERT OR REPLACE` –æ–ø–∞—Å–µ–Ω** —Å `CASCADE DELETE` —Å–≤—è–∑—è–º–∏
2. **UPSERT –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ** –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
3. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω–æ** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–ª–æ–∂–Ω—ã—Ö –±–∞–≥–æ–≤
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ñ–ª–æ—É** –≤–∞–∂–Ω–µ–µ —á–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üéØ –ò–¢–û–ì

‚úÖ **–ü—Ä–æ—Ñ–∏–ª–∏ –±–æ–ª—å—à–µ –ù–ï –ò–°–ß–ï–ó–ê–Æ–¢**  
‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–±–∏–ª—å–Ω–∞**  
‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**  
‚úÖ **CS2 Teammeet Bot –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É**
