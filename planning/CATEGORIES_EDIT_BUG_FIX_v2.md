# –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ë–ê–ì–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ö–ê–¢–ï–ì–û–†–ò–ô v2 üîß

**–î–∞—Ç–∞:** 05.08.2025  
**–°—Ç–∞—Ç—É—Å:** üîß –í –ü–†–û–¶–ï–°–°–ï  
**–í–µ—Ä—Å–∏—è:** 2.0 (–≥–ª—É–±–æ–∫–∏–π —Ñ–∏–∫—Å)  

## üêõ –ü–†–û–ë–õ–ï–ú–ê

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥ **–≤—Å–µ –µ—â–µ –æ—Å—Ç–∞–ª—Å—è** - –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏—è.

## üîç –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –ü–†–ò–ß–ò–ù

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ –≤ main.py
CallbackQueryHandler –¥–ª—è profile_handler –∏–º–µ–ª –ø–∞—Ç—Ç–µ—Ä–Ω, –∫–æ—Ç–æ—Ä—ã–π **–ù–ï –≤–∫–ª—é—á–∞–ª** –Ω–∞—à–∏ –Ω–æ–≤—ã–µ callback'—ã:
```python
# –°–¢–ê–†–´–ô (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
pattern="^(profile_menu|...|edit_(?!media_add|media_replace)|...|edit_media_remove).*$"
# ‚ùå –ù–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç edit_category_* –∏ edit_categories_done
```

### 2. –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å ConversationHandler
ConversationHandler –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –∏–º–µ–ª —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω:
```python
# –ü–†–û–ë–õ–ï–ú–ù–´–ô –ø–∞—Ç—Ç–µ—Ä–Ω
pattern="^(category_|categories_done|back).*$"
# ‚ùå Regex category_ –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å edit_category_*
```

### 3. –ü–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
ConversationHandler –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è **–ü–ï–†–ï–î** –æ—Å–Ω–æ–≤–Ω—ã–º–∏ CallbackQueryHandler'–∞–º–∏, –ø–æ—ç—Ç–æ–º—É –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø v2

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ç—Ç–µ—Ä–Ω CallbackQueryHandler
```python
# –ù–û–í–´–ô (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
pattern="^(profile_menu|...|edit_(?!media_add|media_replace)|...|edit_media_remove|edit_categor).*$"
#                                                                               ‚Üë
#                                                                    –î–æ–±–∞–≤–ª–µ–Ω–æ: edit_categor
```

### 2. –£–∂–µ—Å—Ç–æ—á–µ–Ω –ø–∞—Ç—Ç–µ—Ä–Ω ConversationHandler
```python
# –°–¢–ê–†–´–ô (—Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–π)
pattern="^(category_|categories_done|back).*$"

# –ù–û–í–´–ô (—Ç–æ—á–Ω—ã–π)
pattern="^(category_(mm_premier|faceit|tournaments|looking_for_team)|categories_done|back)$"
#                   ‚Üë                                                                    ‚Üë
#           –¢–æ—á–Ω—ã–µ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π                                                     –ë–µ–∑ .*
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –í handle_callback_query
logger.info(f"Profile handler –ø–æ–ª—É—á–∏–ª callback: {data} –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")

# –í handle_category_toggle  
logger.info(f"handle_category_toggle: –ø–æ–ª—É—á–µ–Ω callback {query.data}")
logger.info(f"handle_category_toggle: category_id={category_id}, selected_categories={selected_categories}")

# –í ConversationHandler
logger.info(f"ConversationHandler: handle_categories_selection –ø–æ–ª—É—á–∏–ª callback: {query.data}")
```

## üîß –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

### 1. `bot/main.py`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è profile CallbackQueryHandler
- ‚úÖ –£–∂–µ—Å—Ç–æ—á–µ–Ω –ø–∞—Ç—Ç–µ—Ä–Ω ConversationHandler

### 2. `bot/handlers/profile.py`  
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ handle_callback_query
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ handle_category_toggle
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ handle_categories_selection (ConversationHandler)

## üß™ –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å" ‚Üí "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" ‚Üí "üéÆ –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π:
   ```
   Profile handler –ø–æ–ª—É—á–∏–ª callback: edit_category_* –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *
   –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º edit_category_ callback: edit_category_* –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *
   handle_category_toggle: –ø–æ–ª—É—á–µ–Ω callback edit_category_*
   ```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- ‚úÖ –ö–Ω–æ–ø–∫–∏ –¥–æ–ª–∂–Ω—ã —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–∞–∂–∞—Ç–∏—è
- ‚úÖ –ì–∞–ª–æ—á–∫–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è/–∏—Å—á–µ–∑–∞—Ç—å
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ì–æ—Ç–æ–≤–æ" –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- ‚úÖ –î—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. **Callback'—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** –±—É–¥—É—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ profile_handler
2. **ConversationHandler** –Ω–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –Ω–∞—à–∏ callback'—ã
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ–∫–∞–∂–µ—Ç —Ç–æ—á–Ω—ã–π –ø—É—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback'–æ–≤
4. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π** –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìä –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤ –ª–æ–≥–∞—Ö:

**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô —Å—Ü–µ–Ω–∞—Ä–∏–π:**
```
INFO - Profile handler –ø–æ–ª—É—á–∏–ª callback: edit_category_faceit –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123
INFO - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º edit_category_ callback: edit_category_faceit –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123  
INFO - handle_category_toggle: –ø–æ–ª—É—á–µ–Ω callback edit_category_faceit
```

**‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô —Å—Ü–µ–Ω–∞—Ä–∏–π:**
```
INFO - ConversationHandler: handle_categories_selection –ø–æ–ª—É—á–∏–ª callback: edit_category_faceit
```

---

**–ï—Å–ª–∏ –±–∞–≥ –æ—Å—Ç–∞–µ—Ç—Å—è, –ª–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã!** üîç
